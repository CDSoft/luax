# crypt: cryptography module

``` lua
local crypt = require "crypt"
```

`crypt` provides cryptography functions.

## Random number generator

The LuaX pseudorandom number generator is a [linear congruential
generator](https://en.wikipedia.org/wiki/Linear_congruential_generator).
This generator is not a cryptographically secure pseudorandom number
generator. It can be used as a repeatable generator (e.g.Â for repeatable
tests).

LuaX has a global generator (with a global seed) and can instantiate
independant generators with their own seeds.

### Random number generator instance

``` lua
local rng = crypt.prng([seed])
```

returns a random number generator starting from the optional seed
`seed`. This object has four methods: `seed([seed])`, `int([m, [n]])`,
`float([a, [b]])` and `str(n)`.

``` lua
rng:seed([seed])
```

sets the seed of the PRNG. The default seed is a number based on the
current time and the process id.

``` lua
rng:int()
```

returns a random integral number between `0` and `crypt.RAND_MAX`.

``` lua
rng:int(m)
```

returns a random integral number between `0` and `m`.

``` lua
rng:int(m, n)
```

returns a random integral number between `m` and `n`.

``` lua
rng:float()
```

returns a random floating point number between `0.0` and `1.0`.

``` lua
rng:float(a)
```

returns a random floating point number between `0.0` and `a`.

``` lua
rng:float(a, b)
```

returns a random floating point number between `a` and `b`.

``` lua
rng:str(bytes)
```

returns a string with `bytes` random bytes.

### Global random number generator

``` lua
crypt.seed([seed])
```

sets the seed of the global PRNG. The default seed is a number based on
the current time and the process id.

``` lua
crypt.int()
```

returns a random integral number between `0` and `crypt.RAND_MAX`.

``` lua
crypt.int(m)
```

returns a random integral number between `0` and `m`.

``` lua
crypt.int(m, n)
```

returns a random integral number between `m` and `n`.

``` lua
crypt.float()
```

returns a random floating point number between `0.0` and `1.0`.

``` lua
crypt.float(a)
```

returns a random floating point number between `0.0` and `a`.

``` lua
crypt.float(a, b)
```

returns a random floating point number between `a` and `b`.

``` lua
crypt.str(bytes)
```

returns a string with `bytes` random bytes.

## Hexadecimal encoding

The hexadecimal encoder transforms a string into a string where bytes
are coded with hexadecimal digits.

``` lua
crypt.hex(data)
```

encodes `data` in hexa.

``` lua
crypt.unhex(data)
```

decodes the hexa `data`.

## Base64 encoding

The base64 encoder transforms a string with non printable characters
into a printable string (see <https://en.wikipedia.org/wiki/Base64>)

``` lua
crypt.base64(data)
```

encodes `data` in base64.

``` lua
crypt.unbase64(data)
```

decodes the base64 `data`.

``` lua
crypt.base64url(data)
```

encodes `data` in base64url.

``` lua
crypt.unbase64url(data)
```

decodes the base64url `data`.

## CRC32 hash

The CRC-32 algorithm has been generated by [pycrc](https://pycrc.org/)
with the `crc-32` algorithm.

``` lua
crypt.crc32(data)
```

computes the CRC32 of `data`.

## CRC64 hash

The CRC-64 algorithm has been generated by [pycrc](https://pycrc.org/)
with the `crc-64-xz` algorithm.

``` lua
crypt.crc64(data)
```

computes the CRC64 of `data`.

## RC4 encryption

RC4 is a stream cipher (see <https://en.wikipedia.org/wiki/RC4>). It is
design to be fast and simple.

``` lua
crypt.rc4(data, key, [drop])
crypt.unrc4(data, key, [drop])      -- note that unrc4 == rc4
```

encrypts/decrypts `data` using the RC4Drop algorithm and the encryption
key `key` (drops the first `drop` encryption steps, the default value of
`drop` is 768).

## TinyCrypt library

The `crypt` contains functions from
[TinyCrypt](https://github.com/intel/tinycrypt).

### SHA256 hash

``` lua
crypt.sha256(data)
```

returns the SHA256 digest of `data`.

### HMAC-SHA256 hash

``` lua
crypt.hmac(data, key)
```

returns the HMAC-SHA256 digest of `data` using `key` as a key.

### HMAC-SHA256 random number generator

``` lua
crypt.hmac_prng(personalization)
```

returns a HMAC PRNG initialized with `personalization` (32 bytes or
more) and some OS dependant entropy. This object has four methods:
`seed([seed])`, `int([m, [n]])`, `float([a, [b]])` and `str(n)`.

### CTR random number generator

``` lua
crypt.ctr_prng(personalization)
```

returns a CTR PRNG initialized with `personalization` (32 bytes of more)
and some OS dependant entropy. This object has three methods:
`seed(seed)`, `int([bytes])` and `frand()`.

### AES-128 encryption

``` lua
crypt.aes(data, key)
```

encrypts `data` using the AES-128-CBC algorithm and the encryption key
`key`.

``` lua
crypt.unaes(data, key)
```

decrypts `data` using the AES-128-CBC algorithm and the encryption key
`key`.

## String methods

Some functions of the `crypt` package are added to the string module:

``` lua
s:hex()             == crypt.hex(s)
s:unhex()           == crypt.unhex(s)
s:base64()          == crypt.base64(s)
s:unbase64()        == crypt.unbase64(s)
s:base64url()       == crypt.base64url(s)
s:unbase64url()     == crypt.unbase64url(s)
s:crc32()           == crypt.crc32(s)
s:crc64()           == crypt.crc64(s)
s:rc4(key, drop)    == crypt.rc4(s, key, drop)
s:unrc4(key, drop)  == crypt.unrc4(s, key, drop)
s:sha256()          == crypt.sha256(s)
s:hmac(key)         == crypt.hmac(s, key)
s:aes(key)          == crypt.aes(s, key)
s:unaes(key)        == crypt.unaes(s, key)
```
